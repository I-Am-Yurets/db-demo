<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Periods Management</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
</head>
<body>
<div class='crud-container' style="width: 500px;">
    <h2 class='crud-title'>Period Management (Secure Parser)</h2>

    <form action='/secure/execute' method='post' id="periodsForm" style="margin-top: 20px;">

        <input type="hidden" name="command" id="finalCommandInput" />

        <div class="crud-form-group">
            <label>ID</label>
            <input type='text' id="p_id" name='id_visual' placeholder='1'/>
        </div>

        <div class="crud-form-group">
            <label>Country ID</label>
            <input type='text' id="p_country_id" name='country_id_visual' placeholder='1'/>
        </div>

        <div class="crud-form-group">
            <label>Period Name</label>
            <input type='text' id="p_period_name" name='period_name_visual' placeholder='2022-2023'/>
        </div>

        <div class="crud-form-group">
            <label>Start Date</label>
            <input type='date' id="p_start_date" name='start_date_visual' class="crud-date-input"/>
        </div>

        <div class="crud-form-group">
            <label>End Date</label>
            <input type='date' id="p_end_date" name='end_date_visual' class="crud-date-input"/>
        </div>

        <div class="crud-form-group">
            <label>Aid Amount (USD)</label>
            <input type='text' id="p_aid" name='aid_visual' placeholder='10000000000'/>
        </div>

        <div class="crud-buttons">
            <button type='button' onclick="buildAndSubmit('find')" class="crud-btn crud-btn-find">Find</button>
            <button type='button' onclick="buildAndSubmit('delete')" class="crud-btn crud-btn-delete">Delete</button>
            <button type='button' onclick="buildAndSubmit('update')" class="crud-btn crud-btn-update">Update</button>
            <button type='button' onclick="buildAndSubmit('add')" class="crud-btn crud-btn-add">Add</button>
        </div>
    </form>

    <p style="margin-top: 30px; text-align: center;">
        <a href="/db-operations" class="btn-back">← Back to Operations</a>
    </p>
</div>

<script>
    function buildAndSubmit(actionType) {
        // Ваш парсер очікує такі назви операцій: read, delete, update, insert
        // Мапимо кнопки на правильні команди
        let operation = actionType;
        if (actionType === 'find') operation = 'read';
        if (actionType === 'add') operation = 'insert';

        const table = 'periods';

        // Зчитуємо значення
        const idVal = document.getElementById('p_id').value.trim();
        const countryIdVal = document.getElementById('p_country_id').value.trim();
        const periodNameVal = document.getElementById('p_period_name').value.trim();
        const startDateVal = document.getElementById('p_start_date').value.trim();
        const endDateVal = document.getElementById('p_end_date').value.trim();
        const aidVal = document.getElementById('p_aid').value.trim();

        let params = [];

        // Додаємо параметри залежно від операції
        if (idVal) {
            params.push(`id='${idVal}'`);
        }

        // Для insert та update потрібні дані
        if (['insert', 'update'].includes(operation)) {
            if (countryIdVal) params.push(`country_id='${countryIdVal}'`);
            if (periodNameVal) params.push(`period_name='${periodNameVal}'`);
            if (startDateVal) params.push(`start_date='${startDateVal}'`);
            if (endDateVal) params.push(`end_date='${endDateVal}'`);
            // Примітка: У вашому парсері немає явного aid_amount_usd для periods,
            // але якщо поле є в БД, додаємо його:
            if (aidVal) params.push(`aid_amount_usd='${aidVal}'`);
        }

        // Формуємо фінальний рядок, наприклад: insert periods(country_id='1', period_name='2022')
        const paramsString = params.join(', ');
        const finalCommand = `${operation} ${table}(${paramsString})`;

        // Записуємо у приховане поле та відправляємо
        console.log("Sending command: " + finalCommand);
        document.getElementById('finalCommandInput').value = finalCommand;
        document.getElementById('periodsForm').submit();
    }
</script>
</body>
</html>
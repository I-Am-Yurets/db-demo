<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Weapons Management</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
</head>
<body>
<div class='crud-container' style="width: 500px;">
    <h2 class='crud-title'>Weapon Management (Secure)</h2>

    <form action='/secure/execute' method='post' id="weaponsForm" style="margin-top: 20px;">

        <input type="hidden" name="command" id="finalCommandInput" />

        <div class="crud-form-group">
            <label>ID</label>
            <input type='text' id="w_id" placeholder='1'/>
        </div>

        <div class="crud-form-group">
            <label>Period ID</label>
            <input type='text' id="w_period_id" placeholder='1'/>
        </div>

        <div class="crud-form-group">
            <label>Weapon Type</label>
            <input type='text' id="w_type" placeholder='Artillery'/>
        </div>

        <div class="crud-form-group">
            <label>Weapon Name</label>
            <input type='text' id="w_name" placeholder='M777 Howitzer'/>
        </div>

        <div class="crud-form-group">
            <label>Quantity</label>
            <input type='text' id="w_quantity" placeholder='100'/>
        </div>

        <div class="crud-form-group">
            <label>Unit Cost (USD)</label>
            <input type='text' id="w_unit_cost" placeholder='2500000'/>
        </div>

        <div class="crud-form-group">
            <label>Total Cost (USD)</label>
            <input type='text' id="w_total_cost" placeholder='250000000'/>
        </div>

        <div class="crud-buttons">
            <button type='button' onclick="submitWeapon('read')" class="crud-btn crud-btn-find">Find</button>
            <button type='button' onclick="submitWeapon('delete')" class="crud-btn crud-btn-delete">Delete</button>
            <button type='button' onclick="submitWeapon('update')" class="crud-btn crud-btn-update">Update</button>
            <button type='button' onclick="submitWeapon('insert')" class="crud-btn crud-btn-add">Add</button>
        </div>
    </form>

    <p style="margin-top: 30px; text-align: center;">
        <a href="/db-operations" class="btn-back">← Back to Operations</a>
    </p>
</div>

<script>
    function submitWeapon(operation) {
        const table = 'weapons';

        // Отримуємо значення з полів (по ID)
        const id = document.getElementById('w_id').value.trim();
        const periodId = document.getElementById('w_period_id').value.trim();
        const type = document.getElementById('w_type').value.trim();
        const name = document.getElementById('w_name').value.trim();
        const quantity = document.getElementById('w_quantity').value.trim();
        const unitCost = document.getElementById('w_unit_cost').value.trim();
        const totalCost = document.getElementById('w_total_cost').value.trim();

        let params = [];

        if (id) {
            params.push(`id='${id}'`);
        }

        // 2. Параметри для Insert та Update
        if (['insert', 'update'].includes(operation)) {
            // Обов'язкові для Insert (згідно з CommandParser)
            if (periodId) params.push(`period_id='${periodId}'`);
            if (type) params.push(`weapon_type='${type}'`);
            if (name) params.push(`weapon_name='${name}'`);

            // Інші поля (якщо заповнені)
            if (quantity) params.push(`quantity='${quantity}'`);
            if (unitCost) params.push(`unit_cost_usd='${unitCost}'`);
            if (totalCost) params.push(`total_cost_usd='${totalCost}'`);
        }

        // 3. Формуємо рядок команди
        // Приклад: insert weapons(period_id='1', weapon_type='Artillery', weapon_name='M777')
        const commandString = `${operation} ${table}(${params.join(', ')})`;

        // 4. Записуємо команду у приховане поле та відправляємо форму
        console.log("Command:", commandString); // Для налагодження
        document.getElementById('finalCommandInput').value = commandString;
        document.getElementById('weaponsForm').submit();
    }
</script>
</body>
</html>